// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Commodity {
  id        String   @id @default(uuid()) @db.Uuid
  ticker    String   @unique
  name      String
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  inventoryItems   InventoryItem[]
  productionOrders ProductionOrder[]
  prices           Price[]

  @@index([ticker])
}

model Base {
  id           String    @id @default(uuid()) @db.Uuid
  planetId     String    @unique
  planetName   String
  username     String
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  inventoryItems   InventoryItem[]
  productionOrders ProductionOrder[]

  @@index([planetId])
  @@index([username])
}

model InventoryItem {
  id               String   @id @default(uuid()) @db.Uuid
  baseId           String   @db.Uuid
  commodityTicker  String
  quantity         Int
  updatedAt        DateTime @updatedAt

  // Relations
  base      Base      @relation(fields: [baseId], references: [id], onDelete: Cascade)
  commodity Commodity @relation(fields: [commodityTicker], references: [ticker], onDelete: Cascade)

  @@unique([baseId, commodityTicker])
  @@index([baseId])
  @@index([commodityTicker])
}

model ProductionOrder {
  id               String   @id @default(uuid()) @db.Uuid
  baseId           String   @db.Uuid
  commodityTicker  String
  quantity         Int
  durationMs       Int
  startedAt        DateTime
  completesAt      DateTime
  isComplete       Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  base      Base      @relation(fields: [baseId], references: [id], onDelete: Cascade)
  commodity Commodity @relation(fields: [commodityTicker], references: [ticker], onDelete: Cascade)

  @@index([baseId])
  @@index([commodityTicker])
}

model Price {
  id               String   @id @default(uuid()) @db.Uuid
  commodityTicker  String
  exchange         String
  buyPrice         Decimal? @db.Decimal(20, 10)
  sellPrice        Decimal? @db.Decimal(20, 10)
  updatedAt        DateTime @updatedAt

  // Relations
  commodity Commodity @relation(fields: [commodityTicker], references: [ticker], onDelete: Cascade)

  @@unique([commodityTicker, exchange])
  @@index([commodityTicker])
}